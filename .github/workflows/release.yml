name: Release

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  build-and-release:
    name: Build and Create Release
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller

    - name: Get version from tag
      id: get_version
      run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
      shell: bash

    - name: Build executable
      run: pyinstaller build/FileMRI_Phase11_Fixed.spec

    - name: Rename executable
      run: |
        $version = "${{ steps.get_version.outputs.VERSION }}"
        if (Test-Path "dist/FileMRI_Phase11_Fixed.exe") {
          Rename-Item "dist/FileMRI_Phase11_Fixed.exe" "DeepFileX_v${version}.exe"
        }
      shell: pwsh

    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/DeepFileX_v${{ steps.get_version.outputs.VERSION }}.exe
          CHANGELOG.md
          README.md
        body: |
          ## ğŸ”· DeepFileX v${{ steps.get_version.outputs.VERSION }}

          ### ğŸ“¥ ë‹¤ìš´ë¡œë“œ
          - **Windows ì‹¤í–‰ íŒŒì¼**: `DeepFileX_v${{ steps.get_version.outputs.VERSION }}.exe`

          ### ğŸ“‹ ë³€ê²½ì‚¬í•­
          ìì„¸í•œ ë³€ê²½ì‚¬í•­ì€ [CHANGELOG.md](https://github.com/quantumlayer/deepfilex/blob/master/CHANGELOG.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

          ### ğŸ’» ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
          - **OS**: Windows 10+ (64bit)
          - **RAM**: 4GB+ ê¶Œì¥
          - **ì €ì¥ê³µê°„**: 100MB+

          ### ğŸš€ ì‚¬ìš© ë°©ë²•
          1. ë‹¤ìš´ë¡œë“œí•œ exe íŒŒì¼ ì‹¤í–‰
          2. ìŠ¤ìº”í•  í´ë” ì„ íƒ
          3. íŒŒì¼ ê²€ìƒ‰ ì‹œì‘!

          ---
          **DeepFileX by QuantumLayer** - Advanced File Analysis System ğŸ”·
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: DeepFileX-Release-v${{ steps.get_version.outputs.VERSION }}
        path: dist/DeepFileX_v${{ steps.get_version.outputs.VERSION }}.exe
